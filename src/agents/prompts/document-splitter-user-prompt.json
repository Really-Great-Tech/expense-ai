{
  "name": "document-splitter-user-prompt",
  "type": "text",
  "version": 1,
  "config": {},
  "prompt": "Analyze these PDF pages to identify individual receipts/invoices. Each page could potentially be a separate receipt unless proven otherwise.\n\nDOCUMENT PAGES:\n{{pagesContent}}\n\nANALYSIS APPROACH:\n1. ASSUME each page is a separate receipt/invoice by default\n2. DISTINGUISH between document containers and individual transactions\n3. Focus on TRANSACTION-LEVEL identifiers, not document-level headers\n4. Look for COMPLETE TRANSACTION CYCLES on individual pages\n5. Ignore container headers that appear across multiple transactions\n\nCRITICAL: CONTAINER vs TRANSACTION DISTINCTION\n- CONTAINER HEADERS: Expense report numbers, document titles, employee names, report dates\n  Examples: \"Nota spese n° 107\", \"Expense Report #2024-001\", \"John Smith Expenses\"\n  → These are DOCUMENT CONTAINERS, not transaction identifiers\n  → IGNORE these for grouping decisions\n\n- TRANSACTION IDENTIFIERS: Individual receipt numbers, store transaction IDs, timestamps\n  Examples: \"Receipt #12345\", \"Trans ID: 789\", \"Order #ABC123\", specific transaction times\n  → These identify INDIVIDUAL TRANSACTIONS within containers\n  → USE these for grouping decisions\n\nINDIVIDUAL RECEIPT INDICATORS (Each suggests a separate receipt):\n- Complete transaction with total amount\n- Separate date/time stamps (different transaction times)\n- Different receipt/invoice numbers (transaction-level, not container-level)\n- Different order/confirmation numbers\n- Separate payment method information\n- Different transaction IDs or reference numbers\n- Complete item lists with subtotals and taxes\n- Different store locations or addresses (even same brand)\n- Separate \"Thank you\" or transaction completion messages\n- Different customer information\n- Standalone QR codes or barcodes\n- Individual merchant signatures or stamps\n\nGROUPING RULES FOR MULTI-PAGE RECEIPTS (Group when MOST criteria match):\n\nSTRONG INDICATORS (Any 2+ suggest same transaction):\n- SAME exact TRANSACTION-LEVEL receipt/invoice number (not container number)\n- SAME exact transaction date/time\n- Clear continuation indicators: \"Page 2 of 3\", \"Continued...\", \"See next page\"\n- Sequential page numbering within same document\n- Incomplete transaction flow (no final total on early pages)\n- Consistent customer/billing information\n- Progressive totals (subtotal → tax → final total across pages)\n\nMULTI-PAGE PATTERNS TO RECOGNIZE:\n- \"Page X of Y\" or \"Page X/Y\"\n- \"Continued on next page\" or \"Continued...\"\n- Same invoice number with different page indicators\n- Building totals: Page 1 shows subtotal, Page 2 shows taxes, Page 3 shows final total\n- Consistent transaction context (same customer, same date, same vendor details)\n- Sequential item listings that continue across pages\n\nSEPARATION RULES (Always separate when ANY of these exist):\n- Different TRANSACTION-LEVEL receipt/invoice numbers\n- Different transaction dates or times (even same day)\n- Complete transaction cycle on EACH page (full start-to-finish flow)\n- Different payment methods or card numbers\n- Different store numbers or locations\n- Different customer names or details\n- Individual transaction completion indicators (\"Thank you\", \"Transaction complete\")\n- Separate merchant signatures or stamps\n- Each page has its own final total (not building totals)\n- Different billing/shipping addresses\n- Standalone QR codes or barcodes on each page\n\nTOTAL AMOUNT CONSIDERATIONS:\n- If pages show BUILDING totals (subtotal → tax → final), likely same transaction\n- If pages show DIFFERENT final totals, definitely separate transactions\n- If only last page shows total, check other indicators for grouping\n- Progressive calculations across pages suggest continuation\n\nEXPENSE REPORT SPECIFIC RULES:\n- If pages have expense report headers (like \"Nota spese\", \"Expense Report\") but different:\n  → Transaction times/dates → SEPARATE\n  → Receipt numbers → SEPARATE\n  → Total amounts → SEPARATE\n  → Store locations → SEPARATE\n- Expense report numbers are CONTAINERS, not transaction identifiers\n- Look WITHIN each page for individual transaction details\n- Each receipt in an expense report should be treated separately\n\nSPECIAL CASES TO WATCH FOR:\n- Digital receipt compilations (multiple complete receipts from same vendor)\n- Expense report collections (employee submitting multiple receipts under one report number)\n- Receipt scanning app outputs (various receipts with app branding)\n- Multi-location same brand receipts (different store numbers/addresses)\n- Subscription billing (multiple months from same provider)\n- E-commerce platform receipts (same platform, different sellers)\n\nCOMMON CONTAINER PATTERNS TO IGNORE FOR GROUPING:\n- \"Nota spese n° [number]\" (Italian expense reports)\n- \"Expense Report #[number]\"\n- \"Travel Expenses - [name/date]\"\n- \"[Employee Name] Reimbursement\"\n- \"Monthly Expenses [month/year]\"\n- Document compilation headers\n- Scanning app watermarks or headers\n\nCONFIDENCE SCORING:\n- 0.9-1.0: Clear individual receipts with complete transaction cycles\n- 0.7-0.8: Likely separate receipts with minor ambiguities\n- 0.5-0.6: Possible separate receipts, some shared elements\n- 0.3-0.4: Unclear boundaries, lean toward separation\n- 0.0-0.2: Strong evidence for grouping (true multi-page invoice)\n\nRESPONSE FORMAT (valid JSON only):\n{\n  \"totalInvoices\": 4,\n  \"pageGroups\": [\n    {\n      \"invoiceNumber\": 1,\n      \"pages\": [1],\n      \"confidence\": 0.95,\n      \"reasoning\": \"Page 1: Individual receipt within expense report - Receipt #12345, total €15.50, 2024-01-15 09:30, Restaurant ABC\"\n    },\n    {\n      \"invoiceNumber\": 2,\n      \"pages\": [2],\n      \"confidence\": 0.92,\n      \"reasoning\": \"Page 2: Individual receipt within expense report - Receipt #67890, total €8.75, 2024-01-15 14:20, Cafe XYZ - different transaction\"\n    },\n    {\n      \"invoiceNumber\": 3,\n      \"pages\": [3],\n      \"confidence\": 0.90,\n      \"reasoning\": \"Page 3: Individual receipt within expense report - Receipt #11111, total €25.00, 2024-01-16 12:00, Hotel DEF - different date/amount\"\n    },\n    {\n      \"invoiceNumber\": 4,\n      \"pages\": [4, 5],\n      \"confidence\": 0.88,\n      \"reasoning\": \"Pages 4-5: Multi-page invoice #INV-2024-001, same invoice number, 'Page 1 of 2' indicator, building totals (subtotal on page 4, final total on page 5)\"\n    }\n  ]\n}\n\nCRITICAL: Respond with ONLY the JSON object. No explanations, markdown formatting, or additional text."
}
